<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 4. Zend_Cache</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
<link rel="start" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="index.html" title="Programmer's Reference Guide">
<link rel="prev" href="zend.auth.adapter.digest.html" title="3.2. Digest Authentication">
<link rel="next" href="zend.cache.theory.html" title="4.2. The theory of caching">
<link rel="chapter" href="zend.html" title="Chapter 1. Zend">
<link rel="chapter" href="zend.acl.html" title="Chapter 2. Zend_Acl">
<link rel="chapter" href="zend.auth.html" title="Chapter 3. Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="Chapter 4. Zend_Cache">
<link rel="chapter" href="zend.config.html" title="Chapter 5. Zend_Config">
<link rel="chapter" href="zend.console.getopt.html" title="Chapter 6. Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="Chapter 7. Zend_Controller">
<link rel="chapter" href="zend.date.html" title="Chapter 8. Zend_Date">
<link rel="chapter" href="zend.db.html" title="Chapter 9. Zend_Db">
<link rel="chapter" href="zend.feed.html" title="Chapter 10. Zend_Feed">
<link rel="chapter" href="zend.filter.html" title="Chapter 11. Zend_Filter">
<link rel="chapter" href="zend.gdata.html" title="Chapter 12. Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="Chapter 13. Zend_Http">
<link rel="chapter" href="zend.json.html" title="Chapter 14. Zend_Json">
<link rel="chapter" href="zend.locale.html" title="Chapter 15. Zend_Locale">
<link rel="chapter" href="zend.log.html" title="Chapter 16. Zend_Log">
<link rel="chapter" href="zend.mail.html" title="Chapter 17. Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="Chapter 18. Zend_Measure">
<link rel="chapter" href="zend.mime.html" title="Chapter 19. Zend_Mime">
<link rel="chapter" href="zend.pdf.html" title="Chapter 20. Zend_Pdf">
<link rel="chapter" href="zend.rest.html" title="Chapter 21. Zend_Rest">
<link rel="chapter" href="zend.search.html" title="Chapter 22. Zend_Search">
<link rel="chapter" href="zend.server.html" title="Chapter 23. Zend_Server">
<link rel="chapter" href="zend.service.html" title="Chapter 24. Zend_Service">
<link rel="chapter" href="zend.session.html" title="Chapter 25. Zend_Session">
<link rel="chapter" href="zend.uri.html" title="Chapter 26. Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="Chapter 27. Zend_Validate">
<link rel="chapter" href="zend.view.html" title="Chapter 28. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Chapter 29. Zend_XmlRpc">
<link rel="appendix" href="coding-standard.html" title="Appendix A. Zend Framework PHP Coding Standard">
<link rel="appendix" href="copyrights.html" title="Appendix B. Copyright Information">
<link rel="index" href="the.index.html" title="Index">
<link rel="section" href="zend.cache.html#zend.cache.introduction" title="4.1. Introduction">
<link rel="section" href="zend.cache.theory.html" title="4.2. The theory of caching">
<link rel="section" href="zend.cache.frontends.html" title="4.3. Zend_Cache frontends">
<link rel="section" href="zend.cache.backends.html" title="4.4. Zend_Cache backends">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 4. Zend_Cache</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.auth.adapter.digest.html">Prev</a> </td>
<th width="60%" align="center"> </th>
<td width="20%" align="right"> <a accesskey="n" href="zend.cache.theory.html">Next</a>
</td>
</tr>
</table></div>
<div class="chapter" lang="en">
<div class="titlepage"><div><div><h2 class="title">
<a name="zend.cache"></a>Chapter 4. Zend_Cache</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="zend.cache.html#zend.cache.introduction">4.1. Introduction</a></span></dt>
<dt><span class="sect1"><a href="zend.cache.theory.html">4.2. The theory of caching</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.cache.theory.html#zend.cache.factory">4.2.1. The <code class="code">Zend_Cache</code> factory method</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.theory.html#zend.cache.tags">4.2.2. Tagging records</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.theory.html#zend.cache.clean">4.2.3. Cleaning the cache</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="zend.cache.frontends.html">4.3. Zend_Cache frontends</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.core">4.3.1. Zend_Cache_Core</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.frontend.output">4.3.2. Zend_Cache_Frontend_Output</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.frontend.function">4.3.3. Zend_Cache_Frontend_Function</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.frontend.class">4.3.4. Zend_Cache_Frontend_Class</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.frontends.file">4.3.5. Zend_Cache_Frontend_File</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.frontends.html#zend.cache.frontends.page">4.3.6. Zend_Cache_Frontend_Page</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="zend.cache.backends.html">4.4. Zend_Cache backends</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="zend.cache.backends.html#zend.cache.backends.file">4.4.1. Zend_Cache_Backend_File</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.backends.html#zend.cache.backends.sqlite">4.4.2. Zend_Cache_Backend_Sqlite</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.backends.html#zend.cache.backends.memcached">4.4.3. Zend_Cache_Backend_Memcached</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.backends.html#zend.cache.backends.apc">4.4.4. Zend_Cache_Backend_APC</a></span></dt>
<dt><span class="sect2"><a href="zend.cache.backends.html#zend.cache.backends.platform">4.4.5. Zend_Cache_Backend_ZendPlatform</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.cache.introduction"></a>4.1. Introduction</h2></div></div></div>
<p>
        <code class="code">Zend_Cache</code> provides a generic way to cache any data.
    </p>
<p>
      Caching in Zend Framework is operated by frontends while cache records are stored through backend adapters
      (<code class="code">File</code>, <code class="code">Sqlite</code>, <code class="code">Memcache</code>...) through a flexible
      system of IDs and tags. Using those, it is easy to delete specific types of records afterwards
      (for example: "delete all cache records marked with a given tag").
    </p>
<p>
        The core of the module (<code class="code">Zend_Cache_Core</code>) is generic, flexible and configurable.
        Yet, for your specific needs there are cache frontends that extend <code class="code">Zend_Cache_Core</code>
        for convinience: <code class="code">Output</code>, <code class="code">File</code>, <code class="code">Function</code> and <code class="code">Class</code>.
    </p>
<div class="example">
<a name="id4786674"></a><p class="title"><b>Example 4.1. Getting a frontend with <code class="code">Zend_Cache::factory()</code></b></p>
<p>
            <code class="code">Zend_Cache::factory()</code> instantiates correct objects and ties them together.
            In this first example, we will use <code class="code">Core</code> frontend together with <code class="code">File</code>
            backend.
        </p>
<pre class="programlisting">&lt;?php
require_once 'Zend/Cache.php';

$frontendOptions = array(
   'lifeTime' =&gt; 7200, // cache lifetime of 2 hours 
   'automaticSerialization' =&gt; true
);

$backendOptions = array(
    'cacheDir' =&gt; './tmp/' // Directory where to put the cache files
);

// getting a Zend_Cache_Core object
$cache = Zend_Cache::factory('Core', 'File', $frontendOptions, $backendOptions);

?&gt;</pre>
<p>
            Now that we have a frontend, we can cache any type of data (we turned on serialization). For
            example, we can cache a result from a very expensive database query. After it is cached, there
            is no need to even connect to the database; records are fetched from cache and unserialized.
        </p>
<pre class="programlisting">&lt;?php

// $cache initialized in previous example

// see if a cache already exists:
if(!$result = $cache-&gt;load('myresult')) {

    // cache miss; connect to the database
    
    $db = Zend_Db::factory( [...] );
    
    $result = $db-&gt;fetchAll('SELECT * FROM huge_table');
    
    $cache-&gt;save($result, 'myresult');
    
} else {

    // cache hit! shout so that we know
    echo "This one is from cache!\n\n";
    
}

print_r($result);

?&gt;</pre>
</div>
<div class="example">
<a name="id4787458"></a><p class="title"><b>Example 4.2. Caching output with <code class="code">Zend_Cache</code> output frontend</b></p>
<p>
            We 'mark up' sections in which we want to cache output by adding some conditional logic,
            encapsulating the section within <code class="code">start()</code> and <code class="code">end()</code> methods (this
            resembles the first example and is the core strategy for caching).
        </p>
<p>
            Inside, output your data as usual - all output will be cached when execution hits the <code class="code">end()</code>
            method. On the next run, the whole section will be skipped in favor of fetching data from cache 
            (as long as the cache record is valid).
        </p>
<pre class="programlisting">&lt;?php

$frontendOptions = array(
   'lifeTime' =&gt; 30,                  // cache lifetime of half a minute
   'automaticSerialization' =&gt; false  // this is default anyway
);

$backendOptions = array('cacheDir' =&gt; './tmp/');

$cache = Zend_Cache::factory('Output', 'File', $frontendOptions, $backendOptions);

// we pass a unique identifier to the start() method
if(!$cache-&gt;start('mypage')) {
    // output as usual:
    
    echo 'Hello world! ';
    echo 'This is cached ('.time().') ';
    
    $cache-&gt;end(); // the output is saved and sent to the browser
}

echo 'This is never cached ('.time().').';

?&gt;       </pre>
<p>
           Notice that we output the result of <code class="code">time()</code> twice; this is something dynamic
           for demonstration purposes. Try running this and then refreshing several times; you will notice
           that the first number doesn't change while second changes as time passes. That is because the first
           number was output in the cached section and is saved among other output.
           After half a minute (we've set lifetime to 30 seconds) the
           numbers should match again because the cache record expired -- only to be cached again. You
           should try this in your brower or console.
       </p>
</div>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        When using Zend_Cache, pay attention to the important cache identifier (passed to <code class="code">save()</code>
        and <code class="code">start()</code>). It must be unique for every resource you cache, otherwise unrelated
        cache records may wipe each other or, even worse, be displayed in place of the other.
    </p></td></tr>
</table></div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.auth.adapter.digest.html">Prev</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="zend.cache.theory.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">3.2. Digest Authentication </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 4.2. The theory of caching</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
