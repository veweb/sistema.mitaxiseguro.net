<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>22.7. Uitbreidbaarheid</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
<link rel="start" href="index.html" title="Referentiegids voor de programmeur">
<link rel="up" href="zend.search.html" title="Hoofdstuk 22. Zend_Search">
<link rel="prev" href="zend.search.charset.html" title="22.6. Karakterset.">
<link rel="next" href="zend.search.java-lucene.html" title="22.8. Interoperatie met Java Lucene">
<link rel="chapter" href="zend.html" title="Hoofdstuk 1. Zend">
<link rel="chapter" href="zend.acl.html" title="Hoofdstuk 2. Zend_Acl">
<link rel="chapter" href="zend.auth.html" title="Hoofdstuk 3. Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="Hoofdstuk 4. Zend_Cache">
<link rel="chapter" href="zend.config.html" title="Hoofdstuk 5. Zend_Config">
<link rel="chapter" href="zend.console.getopt.html" title="Hoofdstuk 6. Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="Hoofdstuk 7. Zend_Controller">
<link rel="chapter" href="zend.date.html" title="Hoofdstuk 8. Zend_Date">
<link rel="chapter" href="zend.db.html" title="Hoofdstuk 9. Zend_Db">
<link rel="chapter" href="zend.feed.html" title="Hoofdstuk 10. Zend_Feed">
<link rel="chapter" href="zend.filter.html" title="Hoofdstuk 11. Zend_Filter">
<link rel="chapter" href="zend.gdata.html" title="Hoofdstuk 12. Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="Hoofdstuk 13. Zend_Http">
<link rel="chapter" href="zend.json.html" title="Hoofdstuk 14. Zend_Json">
<link rel="chapter" href="zend.locale.html" title="Hoofdstuk 15. Zend_Locale">
<link rel="chapter" href="zend.log.html" title="Hoofdstuk 16. Zend_Log">
<link rel="chapter" href="zend.mail.html" title="Hoofdstuk 17. Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="Hoofdstuk 18. Zend_Measure">
<link rel="chapter" href="zend.mime.html" title="Hoofdstuk 19. Zend_Mime">
<link rel="chapter" href="zend.pdf.html" title="Hoofdstuk 20. Zend_Pdf">
<link rel="chapter" href="zend.rest.html" title="Hoofdstuk 21. Zend_Rest">
<link rel="chapter" href="zend.search.html" title="Hoofdstuk 22. Zend_Search">
<link rel="chapter" href="zend.server.html" title="Hoofdstuk 23. Zend_Server">
<link rel="chapter" href="zend.service.html" title="Hoofdstuk 24. Zend_Service">
<link rel="chapter" href="zend.session.html" title="Hoofdstuk 25. Zend_Session">
<link rel="chapter" href="zend.uri.html" title="Hoofdstuk 26. Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="Hoofdstuk 27. Zend_Validate">
<link rel="chapter" href="zend.view.html" title="Hoofdstuk 28. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Hoofdstuk 29. Zend_XmlRpc">
<link rel="appendix" href="coding-standard.html" title="Bijlage A. Zend Framework Programmeer Standaard">
<link rel="appendix" href="copyrights.html" title="Bijlage B. Auteursrechtinformatie">
<link rel="index" href="the.index.html" title="Register">
<link rel="subsection" href="zend.search.extending.html#zend.search.extending.analysis" title="22.7.1. Tekst analysator">
<link rel="subsection" href="zend.search.extending.html#zend.search.extending.scoring" title="22.7.2. Score Algorithmes">
<link rel="subsection" href="zend.search.extending.html#zend.search.extending.storage" title="22.7.3. Opslag containers">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">22.7. Uitbreidbaarheid</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.search.charset.html">Terug</a> </td>
<th width="60%" align="center">Hoofdstuk 22. Zend_Search</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.search.java-lucene.html">Volgende</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="nl">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.search.extending"></a>22.7. Uitbreidbaarheid</h2></div></div></div>
<div class="sect2" lang="nl">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.extending.analysis"></a>22.7.1. Tekst analysator</h3></div></div></div>
<p>
            De <code class="code">Zend_Search_Lucene_Analysis_Analyzer</code> klasse wordt gebruikt door de indexer
			om tekstvelden van het document van tokens te voorzien.
        </p>
<p>
            De <code class="code">Zend_Search_Lucene_Analysis_Analyzer::getDefault()</code> en <code class="code">Zend_Search_Lucene_Analysis_Analyzer::setDefault()</code> methodes worden gebruikt om de
			standaard analysator te verkrijgen of te zetten.
        </p>
<p>
		    Je kan dus je eigen tekst analysator aanwijzen of er één kiezen uit de aangeboden set van analysators:
            <code class="code">Zend_Search_Lucene_Analysis_Analyzer_Common_Text</code> en <code class="code">Zend_Search_Lucene_Analysis_Analyzer_Common_Text_CaseInsensitive</code> (standaard).
			Beiden interpreteren tokens als een opeenvolging van letters. <code class="code">Zend_Search_Lucene_Analysis_Analyzer_Common_Text_CaseInsensitive</code> past tokens aan
			naar kleine letters.
        </p>
<p>
		    Om tussen analysatoren te wisselen kan je de volgende code gebruiken:
        </p>
<pre class="programlisting">&lt;?php

Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new Zend_Search_Lucene_Analysis_Analyzer_Common_Text());
...
$index-&gt;addDocument($doc);

?&gt;</pre>
<p>
            De <code class="code">Zend_Search_Lucene_Analysis_Analyzer_Common</code> is ontworpen om de parent van alle door gebruikers gedefinieerde
			analysatoren te zijn. De gebruiker zou alleen de <code class="code">tokenize()</code> methode moeten schrijven, die
			een string als input data moet aanvaarden en een array van tokens moet terugsturen.
        </p>
<p>
            De <code class="code">tokenize()</code> methode zou de <code class="code">normalize()</code> methode op alle tokens moeten toepassen.
			Dit laat toe token filters te gebuiken met jouw analysator.
        </p>
<p>
		    Hier is een voorbeeld van een zelfgemaakte analysator, welke woorden met cijfers als termen aanvaardt:

            </p>
<div class="example">
<a name="id4868721"></a><p class="title"><b>Voorbeeld 22.1. Custom tekst Analysator</b></p>
<pre class="programlisting">&lt;?php
/** Dit is een zelfgemaakte tekst analysator, die woorden met cijfers als een enkele term beschouwt */


/** Zend_Search_Lucene_Analysis_Analyzer_Common */
require_once 'Zend/Search/Lucene/Analysis/Analyzer/Common.php';

class My_Analyzer extends Zend_Search_Lucene_Analysis_Analyzer_Common
{
    /**
	 * Tekst van termtokens voorzien
	 * Geeft een array van Zend_Search_Lucene_Analysis_Token objecten terug
     *
     * @param string $data
     * @return array
     */
    public function tokenize($data)
    {
        $tokenStream = array();

        $position = 0;
        while ($position &lt; strlen($data)) {
            // spaties overslaan
            while ($position &lt; strlen($data) &amp;&amp; !ctype_alpha($data{$position}) &amp;&amp; !ctype_digit($data{$position})) {
                $position++;
            }

            $termStartPosition = $position;

            // token lezen
            while ($position &lt; strlen($data) &amp;&amp; (ctype_alpha($data{$position}) || ctype_digit($data{$position}))) {
                $position++;
            }

            // Leeg token, einde van de stream.
            if ($position == $termStartPosition) {
                break;
            }

            $token = new Zend_Search_Lucene_Analysis_Token(substr($data,
                                             $termStartPosition,
                                             $position-$termStartPosition),
                                      $termStartPosition,
                                      $position);
            $tokenStream[] = $this-&gt;normalize($token);
        }

        return $tokenStream;
    }
}

Zend_Search_Lucene_Analysis_Analyzer::setDefault(
    new My_Analyzer());

?&gt;</pre>
</div>
<p>
        </p>
</div>
<div class="sect2" lang="nl">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.extending.scoring"></a>22.7.2. Score Algorithmes</h3></div></div></div>
<p>
			De score van een query <code class="literal">q</code> voor document <code class="literal">d</code>
            is als volgt gedefinieerd:
        </p>
<p>
            <code class="code">score(q,d) = sum( tf(t in d) * idf(t) * getBoost(t.field in d) * lengthNorm(t.field in d)  ) *
            coord(q,d) * queryNorm(q)</code>
        </p>
<p>
            tf(t in d) - <code class="code">Zend_Search_Lucene_Search_Similarity::tf($freq)</code> - een score factor gebaseerd op
			de frequentie van een term of zin in een document.
        </p>
<p>
            idf(t) - <code class="code">Zend_Search_Lucene_Search_SimilaritySimilarity::tf($term, $reader)</code> - een score factor
			van een eenvoudige term voor de gespecificeerde index.
        </p>
<p>
            getBoost(t.field in d) - boost factor voor het termveld.
        </p>
<p>
            lengthNorm($term) - de normalisatiewaarde voor een veld, gegeven het totaal
			aantal termen in een veld. Deze waarde wordt opgeslagen met de index. Deze waarden,
			samen met de veldboosts, worden opgeslaan in een index en vermenigvuldigd in scores
			door de zoekcode voor hits op elk veld.
        </p>
<p>
			Overeenkomsten op langere velden zijn minder precies, dus geven implementaties
			van deze methode meestal kleinere waarden terug als numTokens groot is, en
			grotere waarden als numTokens klein is.
        </p>
<p>
            coord(q,d) - <code class="code">Zend_Search_Lucene_Search_Similarity::coord($overlap, $maxOverlap)</code> - een score
			factor gebaseerd op de fractie van alle query termen dat een document bevat.
        </p>
<p>
			De aanwezigheid van een groot deel van de query termen duidt een betere overeenkomst
			met de query aan, dus zullen implementaties van deze methode meestal grotere waarden
			teruggeven wanneer de ratio tussen deze parameters groot is en kleinere waarden wanneer
			de ratio ertussen klein is.
        </p>
<p>
            queryNorm(q) -  de normalizatiewaarde voor een query gegeven de som van de
			gewichten van elk van de querytermen in het vierkant. Het gewicht van elke query term 
			wordt dan vermenigvuldigd met deze waarde.
        </p>
<p>
			Dit beïnvloedt het ordenen niet, maar probeert enkel scores van verschillende queries
			vergelijkbaar te maken.
        </p>
<p>
			Het scoring algoritme kan verpersoonlijkt worden door je eigen Similarity klasse te maken. Om
			dit te doen moet je de Zend_Search_Lucene_Search_Similarity klasse uitbreiden zoals hierna is
			gedefinieerd, en dan de <code class="code">Zend_Search_Lucene_Search_Similarity::setDefault($similarity);</code> 
			methode gebruiken om het tot standaard te zetten.
        </p>
<pre class="programlisting">&lt;?php

class MySimilarity extends Zend_Search_Lucene_Search_Similarity {
    public function lengthNorm($fieldName, $numTerms) {
        return 1.0/sqrt($numTerms);
    }

    public function queryNorm($sumOfSquaredWeights) {
        return 1.0/sqrt($sumOfSquaredWeights);
    }

    public function tf($freq) {
        return sqrt($freq);
    }

    /**
     * Wordt nu niet gebruikt. Berekent het aandeel van een slordige zinovereenkomst,
     * gebaseerd op een edit afstand.
     */
    public function sloppyFreq($distance) {
        return 1.0;
    }

    public function idfFreq($docFreq, $numDocs) {
        return log($numDocs/(float)($docFreq+1)) + 1.0;
    }

    public function coord($overlap, $maxOverlap) {
        return $overlap/(float)$maxOverlap;
    }
}

$mySimilarity = new MySimilarity();
Zend_Search_Lucene_Search_Similarity::setDefault($mySimilarity);

?&gt;</pre>
</div>
<div class="sect2" lang="nl">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.extending.storage"></a>22.7.3. Opslag containers</h3></div></div></div>
<p>
		Een abstracte klasse Zend_Search_Lucene_Storage_Directory definieert mapfunctionaliteit.
        </p>
<p>
		De Zend_Search_Lucene constructor gebruikt ofwel een string of een Zend_Search_Lucene_Storage_Directory object
        als input.
        </p>
<p>
        De Zend_Search_Lucene_Storage_Directory_Filesystem klasse implementeert mapfunctionaliteit voor het
		bestandssyteem.
        </p>
<p>
		Indien een string werd opgegeven als input voor de Zend_Search_Lucene constructor, zal de
		indexlezer (Zend_Search_Lucene object) het beschouwen als een bestandssysteempad en zelf een
		Zend_Search_Lucene_Storage_Directory_Filesystem object instantiëren.
        </p>
<p>
		Je kan je eigen implementatiemap definiëren door de Zend_Search_Lucene_Storage_Directory klasse uit te breiden.
        </p>
<p>
        Zend_Search_Lucene_Storage_Directory methodes:
        </p>
<pre class="programlisting">&lt;?php

abstract class Zend_Search_Lucene_Storage_Directory {
/**
 * Sluit de opslag.
 *
 * @return void
 */
abstract function close();


/**
 * Maakt een nieuw, leeg bestand in de map met gegeven $filename.
 *
 * @param string $name
 * @return void
 */
abstract function createFile($filename);


/**
 * Verwijdert een bestaande $filename uit de map.
 *
 * @param string $filename
 * @return void
 */
abstract function deleteFile($filename);


/**
 * Geeft true terug indien een bestand met gegeven $filename bestaat.
 *
 * @param string $filename
 * @return boolean
 */
abstract function fileExists($filename);


/**
 * Geeft de lengte terug van een bestand $filename in de map.
 *
 * @param string $filename
 * @return integer
 */
abstract function fileLength($filename);


/**
 * Geeft de UNIX timestamp terug van de laatste wijziging van $filename.
 *
 * @param string $filename
 * @return integer
 */
abstract function fileModified($filename);


/**
 * Hernoemt een bestaand bestand in de map.
 *
 * @param string $from
 * @param string $to
 * @return void
 */
abstract function renameFile($from, $to);


/**
 * Zet de gewijzigde tijd van $filename naar nu.
 *
 * @param string $filename
 * @return void
 */
abstract function touchFile($filename);


/**
 * Geeft een Zend_Search_Lucene_Storage_File object terug voor een gegeven $filename in de map.
 *
 * @param string $filename
 * @return Zend_Search_Lucene_Storage_File
 */
abstract function getFileObject($filename);

}

?&gt;</pre>
<p>
        De <code class="code">getFileObject($filename)</code> methode van de Zend_Search_Lucene_Storage_Directory klasse geeft
        een Zend_Search_Lucene_Storage_File object terug.
        </p>
<p>
        De abstrakte klasse Zend_Search_Lucene_Storage_File implementeert bestandsabstractie en voorziet in indexbestand
		leesprimitieven.
        </p>
<p>
		Je moet ook de Zend_Search_Lucene_Storage_File klasse uitbreiden voor jouw Directory implementatie.
        </p>
<p>
		Slechts twee methodes van de Zend_Search_Lucene_Storage_File klasse hoeven te worden overloaded in jouw implementatie:
        </p>
<pre class="programlisting">&lt;?php

class MyFile extends Zend_Search_Lucene_Storage_File {
    /**
	 * Zet de bestandpositie indicator en zet de bestandswijzer voort.
	 * De nieuwe positie, berekend in bytes vanaf het begin van het
	 * bestand, wordt verkregen door offset aan de door $whence aangegeven
	 * positie te voegen, welke waarden als volgt zijn gedefinieerd::
     * SEEK_SET - Zet de positie gelijk aan offset bytes.
     * SEEK_CUR - Zet de positie aan de huidige lokatie plus offset.
     * SEEK_END - Zet de positie tot einde-van-bestand plus offset. (Om naar
	 * een positie vòòr einde-van-bestand te gaan moet je een negatieve waarde
	 * aan offset toekennen.)
     * Geeft 0 indien success; anders -1
     *
     * @param integer $offset
     * @param integer $whence
     * @return integer
     */
    public function seek($offset, $whence=SEEK_SET) {
        ...
    }

    /**
	 * Lees $length bytes van het bestand en beweeg de bestandswijzer voort.
     *
     * @param integer $length
     * @return string
     */
    protected function _fread($length=1) {
        ...
    }
}

?&gt;</pre>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.search.charset.html">Terug</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.search.html">Omhoog</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.search.java-lucene.html">Volgende</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">22.6. Karakterset. </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td>
<td width="40%" align="right" valign="top"> 22.8. Interoperatie met Java Lucene</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
