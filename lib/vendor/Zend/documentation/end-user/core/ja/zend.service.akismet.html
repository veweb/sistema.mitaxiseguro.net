<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>24.2. Zend_Service_Akismet</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
<link rel="start" href="index.html" title="プログラマ向けリファレンスガイド">
<link rel="up" href="zend.service.html" title="第24章 Zend_Service">
<link rel="prev" href="zend.service.html" title="第24章 Zend_Service">
<link rel="next" href="zend.service.amazon.html" title="24.3. Zend_Service_Amazon">
<link rel="chapter" href="zend.html" title="第1章 Zend">
<link rel="chapter" href="zend.acl.html" title="第2章 Zend_Acl">
<link rel="chapter" href="zend.auth.html" title="第3章 Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="第4章 Zend_Cache">
<link rel="chapter" href="zend.config.html" title="第5章 Zend_Config">
<link rel="chapter" href="zend.console.getopt.html" title="第6章 Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="第7章 Zend_Controller">
<link rel="chapter" href="zend.date.html" title="第8章 Zend_Date">
<link rel="chapter" href="zend.db.html" title="第9章 Zend_Db">
<link rel="chapter" href="zend.feed.html" title="第10章 Zend_Feed">
<link rel="chapter" href="zend.filter.html" title="第11章 Zend_Filter">
<link rel="chapter" href="zend.gdata.html" title="第12章 Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="第13章 Zend_Http">
<link rel="chapter" href="zend.json.html" title="第14章 Zend_Json">
<link rel="chapter" href="zend.locale.html" title="第15章 Zend_Locale">
<link rel="chapter" href="zend.log.html" title="第16章 Zend_Log">
<link rel="chapter" href="zend.mail.html" title="第17章 Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="第18章 Zend_Measure">
<link rel="chapter" href="zend.mime.html" title="第19章 Zend_Mime">
<link rel="chapter" href="zend.pdf.html" title="第20章 Zend_Pdf">
<link rel="chapter" href="zend.rest.html" title="第21章 Zend_Rest">
<link rel="chapter" href="zend.search.html" title="第22章 Zend_Search">
<link rel="chapter" href="zend.server.html" title="第23章 Zend_Server">
<link rel="chapter" href="zend.service.html" title="第24章 Zend_Service">
<link rel="chapter" href="zend.session.html" title="第25章 Zend_Session">
<link rel="chapter" href="zend.uri.html" title="第26章 Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="第27章 Zend_Validate">
<link rel="chapter" href="zend.view.html" title="第28章 Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="第29章 Zend_XmlRpc">
<link rel="appendix" href="coding-standard.html" title="付録 A. Zend Framework PHP 標準コーディング規約">
<link rel="appendix" href="copyrights.html" title="付録 B. 著作権に関する情報">
<link rel="index" href="the.index.html" title="目次">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.introduction" title="24.2.1. 導入">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.verifykey" title="24.2.2. API キーの検証">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.isspam" title="24.2.3. スパムのチェック">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.submitspam" title="24.2.4. 既知のスパムの送信">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.submitham" title="24.2.5. 無実のデータ (ハム) の送信">
<link rel="subsection" href="zend.service.akismet.html#zend.service.akismet.accessors" title="24.2.6. Zend 固有のアクセス用メソッド">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">24.2. Zend_Service_Akismet</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.service.html">前のページ</a> </td>
<th width="60%" align="center">第24章 Zend_Service</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.service.amazon.html">次のページ</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="ja">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.service.akismet"></a>24.2. Zend_Service_Akismet</h2></div></div></div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.introduction"></a>24.2.1. 導入</h3></div></div></div>
<p>
            <code class="code">Zend_Service_Akismet</code> は、<a href="http://akismet.com/development/api/" target="_top">Akismet API</a>
            のクライアント機能を提供します。Akismet サービスは、
            入力データがスパムかどうかを判定するために用いられます。
            また、あるデータを「スパムである」とか「無実である (ハム)」
            などと登録するためのメソッドも公開しています。
            もともとは Wordpress 向けのスパムを識別するために作られたものですが、
            あらゆる型のデータに対して使用できます。
        </p>
<p>
            Akismet を使用するには API キーが必要です。
            キーを取得するには <a href="http://wordpress.com/" target="_top">WordPress.com</a>
            でアカウントを作成します。blog を作成する必要はありません。
            単にアカウントを作成するだけで API キーが使用できます。
        </p>
<p>
            さらに、Akismet を使用する場合は、
            フィルタリングしたいデータを指す URL を指定してリクエストする必要があります。
            Akismet は WordPress 向けに作られたものであることから、
            これは blog url と呼ばれます。
            これは、コンストラクタの二番目の引数として渡さなければなりません。
            ただ、いつでも <code class="code">setBlogUrl()</code> で変更することができますし、
            その他のメソッドコールの際に 'blog' キーを指定して上書きすることもできます。
        </p>
</div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.verifykey"></a>24.2.2. API キーの検証</h3></div></div></div>
<p>
            <code class="code">Zend_Service_Akismet::verifyKey($key)</code>
            を使用して、Akismet API キーが有効かどうかを検証します。
            たいていの場合は特に検証する必要もないでしょうが、
            改ざんされていないかどうか調べたり、
            新しく取得したキーが実際に使用可能かどうかを調べたり
            といった場合にこのメソッドを使用します。
        </p>
<pre class="programlisting">&lt;?php
require_once 'Zend/Service/Akismet.php';

// API キー、そしてアプリケーションやリソースへの URL
// を指定してインスタンスを作成します
$akismet = new Zend_Service_Akismet($apiKey, 'http://framework.zend.com/wiki/');
if ($akismet-&gt;verifyKey($apiKey) {
echo "このキーは有効です。\n";
} else {
echo "このキーは無効です。\n";
}
?&gt;</pre>
<p>
            引数を指定せずにコールすると、<code class="code">verifyKey()</code>
            はコンストラクタで指定した API キーを使用します。
        </p>
<p>
            <code class="code">verifyKey()</code> は、Akismet の
            <code class="code">verify-key</code> REST メソッドを実装したものです。
        </p>
</div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.isspam"></a>24.2.3. スパムのチェック</h3></div></div></div>
<p>
            <code class="code">Zend_Service_Akismet::isSpam($data)</code>
            を使用して、Akismet がそのデータをスパムとみなすかどうかを調べます。
            引数はひとつで、ここに連想配列を指定することができます。
            この配列には、次のキーを設定しなければなりません。
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    <code class="code">user_ip</code> は、データを送信したユーザの
                    IP アドレスです (あなたの IP アドレスではなく、
                    あなたのサイトを使用しているユーザの IP アドレスです)。
                </p></li>
<li><p>
                    <code class="code">user_agent</code> は、データを送信したユーザの
                    UserAgent 文字列 (ブラウザおよびバージョン) です。
                </p></li>
</ul></div>
<p>
            以下のキーも、API 側で認識されます。
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    <code class="code">blog</code> は、リソースやアプリケーションを指す
                    完全な URL です。指定しなかった場合は、
                    コンストラクタに渡した URL を使用します。
                </p></li>
<li><p>
                    <code class="code">referrer</code> は、送信時の
                    HTTP_REFERER ヘッダの内容です
                    (スペルに注意しましょう。ヘッダの名前とは異なります)。
                </p></li>
<li><p>
                    <code class="code">permalink</code> は、送信するデータの永続的な場所
                    (もしあれば) です。
                </p></li>
<li><p>
                    <code class="code">comment_type</code> は、データの形式です。
                    ここで指定する値は API で定義されており、
                    'comment'、'trackback'、'pingback' およｂ
                    空の文字列 ('') などがあります。しかし、
                    任意の値を指定することができます。
                </p></li>
<li><p>
                    <code class="code">comment_author</code> は、データの送信者の名前です。
                </p></li>
<li><p>
                    <code class="code">comment_author_email</code> は、
                    データの送信者のメールアドレスです。
                </p></li>
<li><p>
                    <code class="code">comment_author_url</code> は、
                    データの送信者の URL あるいはホームページです。
                </p></li>
<li><p>
                    <code class="code">comment_content</code> は、
                    実際に送信されたデータの内容です。
                </p></li>
</ul></div>
<p>
            その他の環境変数の内容を送信し、
            そのデータがスパムであるかどうかの判断材料とさせることもできます。
            Akismet は、$_SERVER 配列の中身をすべて送信することを推奨しています。
        </p>
<p>
            <code class="code">isSpam()</code> メソッドは true あるいは false を返します。
            API キーが無効な場合は例外をスローします。
        </p>
<div class="example">
<a name="id4890765"></a><p class="title"><b>例 24.1. isSpam() の使用法</b></p>
<pre class="programlisting">&lt;?php
$data = array(
    'user_ip'              =&gt; '111.222.111.222',
    'user_agent'           =&gt; 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         =&gt; 'contact',
    'comment_author'       =&gt; '誰かさん',
    'comment_author_email' =&gt; 'nospam@myhaus.net',
    'comment_content'      =&gt; "スパマーじゃないもん。信じて!"
);
if ($akismet-&gt;isSpam($data)) {
    echo "悪いけど、たぶんあなたはスパマーでしょう。";
} else {
    echo "私たちのサイトへようこそ!";
}
?&gt;</pre>
</div>
<p>
            <code class="code">isSpam()</code> は、Akismet API のメソッド
            <code class="code">comment-check</code> を実装したものです。
        </p>
</div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.submitspam"></a>24.2.4. 既知のスパムの送信</h3></div></div></div>
<p>
            時には、スパムがフィルタを通過してしまうこともあります。
            フィルタを通過したデータの中に、もし「これはスパムだろう」
            というものが見つかったら、それを Akismet
            に送信しましょう。それにより、フィルタの性能が向上します。
        </p>
<p>
            <code class="code">Zend_Service_Akismet::submitSpam()</code> に指定する配列は、
            <code class="code">isSpam()</code> に渡すものと同じ形式です。
            しかし、このメソッドは値を返しません。
            API キーが無効な場合は例外が発生します。
        </p>
<div class="example">
<a name="id4890846"></a><p class="title"><b>例 24.2. submitSpam() の使用法</b></p>
<pre class="programlisting">&lt;?php
$data = array(
    'user_ip'              =&gt; '111.222.111.222',
    'user_agent'           =&gt; 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         =&gt; 'contact',
    'comment_author'       =&gt; '誰かさん',
    'comment_author_email' =&gt; 'nospam@myhaus.net',
    'comment_content'      =&gt; "スパマーじゃないもん。信じて!"
);
$akismet-&gt;submitSpam($data));
?&gt;</pre>
</div>
<p>
            <code class="code">submitSpam()</code> は、Akismet API のメソッド
            <code class="code">submit-spam</code> を実装したものです。
        </p>
</div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.submitham"></a>24.2.5. 無実のデータ (ハム) の送信</h3></div></div></div>
<p>
            時には、Akismet が間違ってスパムと判定してしまうこともあります。
            そのため、Akismet がスパムと判断したデータのログを定期的にチェックする必要があります。
            このような現象を発見したら、そのデータを Akismet に「ハム」
            あるいは無実のデータとして送信しましょう
            (ハムは善玉、スパムは悪玉です)。
        </p>
<p>
            <code class="code">Zend_Service_Akismet::submitHam()</code> に指定する配列は、
            <code class="code">isSpam()</code> や <code class="code">submitSpam()</code>
            に渡すものと同じ形式です。また、
            <code class="code">submitSpam()</code> と同様、値を返しません。
            API キーが無効な場合は例外が発生します。
        </p>
<div class="example">
<a name="id4890934"></a><p class="title"><b>例 24.3. submitHam() の使用法</b></p>
<pre class="programlisting">&lt;?php
$data = array(
    'user_ip'              =&gt; '111.222.111.222',
    'user_agent'           =&gt; 'Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.8.1) Gecko/20061010 Firefox/2.0',
    'comment_type'         =&gt; 'contact',
    'comment_author'       =&gt; '誰かさん',
    'comment_author_email' =&gt; 'nospam@myhaus.net',
    'comment_content'      =&gt; "スパマーじゃないもん。信じて!"
);
$akismet-&gt;submitHam($data));
?&gt;</pre>
</div>
<p>
            <code class="code">submitHam()</code> は、Akismet API のメソッド
            <code class="code">submit-ham</code> を実装したものです。
        </p>
</div>
<div class="sect2" lang="ja">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.service.akismet.accessors"></a>24.2.6. Zend 固有のアクセス用メソッド</h3></div></div></div>
<p>
            Akismet API では四つのメソッドしか定義されていませんが、
            <code class="code">Zend_Service_Akismet</code> では
            それ以外のアクセス用メソッドも用意しています。
            これらを使用して、内部のプロパティを変更します。
        </p>
<div class="itemizedlist"><ul type="disc">
<li><p>
                    <code class="code">getBlogUrl()</code> および <code class="code">setBlogUrl()</code>
                    は、リクエストで使用する blog URL を取得したり変更したりします。
                </p></li>
<li><p>
                    <code class="code">getApiKey()</code> および <code class="code">setApiKey()</code>
                    は、リクエストで使用する API キーを取得したり変更したりします。
                </p></li>
<li><p>
                    <code class="code">getCharset()</code> および <code class="code">setCharset()</code>
                    は、リクエストで使用する文字セットを取得したり変更したりします。
                </p></li>
<li><p>
                    <code class="code">getPort()</code> および <code class="code">setPort()</code>
                    は、リクエストで使用する TCP ポートを取得したり変更したりします。
                </p></li>
<li>
<p>
                    <code class="code">getUserAgent()</code> および <code class="code">setUserAgent()</code>
                    は、リクエストで使用する HTTP ユーザエージェントを
                    取得したり変更したりします。
                    注意: これは、サービスに送信するデータの user_agent
                    ではありません。サービスへのリクエストを作成する際に
                    HTTP User-Agent ヘッダで指定する内容となります。
                </p>
<p>
                    ユーザエージェントに設定する値は
                    <code class="code">some user agent/version | Akismet/version</code>
                    形式でなければなりません。デフォルトは
                    <code class="code">Zend Framework/0.7.0 | Akismet/1.11</code>
                    です。
                </p>
</li>
</ul></div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.service.html">前のページ</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.service.html">上に戻る</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.service.amazon.html">次のページ</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">第24章 Zend_Service </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td>
<td width="40%" align="right" valign="top"> 24.3. Zend_Service_Amazon</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
