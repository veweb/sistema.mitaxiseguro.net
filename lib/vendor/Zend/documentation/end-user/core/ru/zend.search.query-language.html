<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>22.4. Язык запросов</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
<link rel="start" href="index.html" title="Руководство разработчика">
<link rel="up" href="zend.search.html" title="Глава 22. Zend_Search">
<link rel="prev" href="zend.search.searching.html" title="22.3. Поиск по индексу">
<link rel="next" href="zend.search.queries.html" title="22.5. Типы запросов ">
<link rel="chapter" href="zend.html" title="Глава 1. Zend">
<link rel="chapter" href="zend.acl.html" title="Глава 2. Zend_Acl">
<link rel="chapter" href="zend.auth.html" title="Глава 3. Zend_Auth">
<link rel="chapter" href="zend.cache.html" title="Глава 4. Zend_Cache">
<link rel="chapter" href="zend.config.html" title="Глава 5. Zend_Config">
<link rel="chapter" href="zend.console.getopt.html" title="Глава 6. Zend_Console_Getopt">
<link rel="chapter" href="zend.controller.html" title="Глава 7. Zend_Controller">
<link rel="chapter" href="zend.date.html" title="Глава 8. Zend_Date">
<link rel="chapter" href="zend.db.html" title="Глава 9. Zend_Db">
<link rel="chapter" href="zend.feed.html" title="Глава 10. Zend_Feed">
<link rel="chapter" href="zend.filter.html" title="Глава 11. Zend_Filter">
<link rel="chapter" href="zend.gdata.html" title="Глава 12. Zend_Gdata">
<link rel="chapter" href="zend.http.html" title="Глава 13. Zend_Http">
<link rel="chapter" href="zend.json.html" title="Глава 14. Zend_Json">
<link rel="chapter" href="zend.locale.html" title="Глава 15. Zend_Locale">
<link rel="chapter" href="zend.log.html" title="Глава 16. Zend_Log">
<link rel="chapter" href="zend.mail.html" title="Глава 17. Zend_Mail">
<link rel="chapter" href="zend.measure.html" title="Глава 18. Zend_Measure">
<link rel="chapter" href="zend.mime.html" title="Глава 19. Zend_Mime">
<link rel="chapter" href="zend.pdf.html" title="Глава 20. Zend_Pdf">
<link rel="chapter" href="zend.rest.html" title="Глава 21. Zend_Rest">
<link rel="chapter" href="zend.search.html" title="Глава 22. Zend_Search">
<link rel="chapter" href="zend.server.html" title="Глава 23. Zend_Server">
<link rel="chapter" href="zend.service.html" title="Глава 24. Zend_Service">
<link rel="chapter" href="zend.session.html" title="Глава 25. Zend_Session">
<link rel="chapter" href="zend.uri.html" title="Глава 26. Zend_Uri">
<link rel="chapter" href="zend.validate.html" title="Глава 27. Zend_Validate">
<link rel="chapter" href="zend.view.html" title="Глава 28. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Глава 29. Zend_XmlRpc">
<link rel="appendix" href="coding-standard.html" title="Приложение A. Стандарт кодирования на PHP в Zend Framework'е">
<link rel="appendix" href="copyrights.html" title="Приложение B. Copyright Information">
<link rel="index" href="the.index.html" title="Предметный указатель">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.terms" title="22.4.1. Элементы">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.fields" title="22.4.2. Поля">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.modifiers" title="22.4.3. Модификаторы элементов">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.proximity-search" title="22.4.4. Поиск по критерию близости">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.boosting" title="22.4.5. Усиление элемента">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.boolean" title="22.4.6. Булевы операторы">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.grouping" title="22.4.7. Групирование">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.field-grouping" title="22.4.8. Группирование полей">
<link rel="subsection" href="zend.search.query-language.html#zend.search.query-language.escaping" title="22.4.9. Экранирование специальных символов">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">22.4. Язык запросов</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.search.searching.html">Пред.</a> </td>
<th width="60%" align="center">Глава 22. Zend_Search</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.search.queries.html">След.</a>
</td>
</tr>
</table></div>
<div class="sect1" lang="ru">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.search.query-language"></a>22.4. Язык запросов</h2></div></div></div>
<p>
        Java Lucene и Zend_Search_Lucene предоставляют мощный язык запросов.

    </p>
<p>
        Он в основном один и тот же, но имеются некоторые различия, которые
        будут описаны ниже.  

    </p>
<p>
        Полную документацию по синтаксису запросов для Java Lucene можно найти
        <a href="http://lucene.apache.org/java/docs/queryparsersyntax.html" target="_top">здесь</a>.   

    </p>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.terms"></a>22.4.1. Элементы</h3></div></div></div>
<p>
            Запрос делится на элементы и операторы. Есть следующие типы
            элементов: одиночный элемент, фразы и подзапросы. 

        </p>
<p>
            Одиночный элемент – это одно слово, например: "test" или "hello".

        </p>
<p>
            Фраза – это группа слов, окруженная двойными кавычками, например:
            "hello dolly".

        </p>
<p>
            Подзапрос – это запрос, окруженный скобками, например: "(hello
            dolly)".

        </p>
<p>
            Несколько элемнтов могут комбинироваться с булевыми операторами для
            составления более сложных запросов (см. ниже).
            

        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.fields"></a>22.4.2. Поля</h3></div></div></div>
<p>
            Lucene поддерживает данные, хранящиеся в полях. Производя поиск,
            можно указывать поля или использовать поле по умолчанию. Имена полей
            зависят от проиндексированных данных, а используемое по умолчание
            поле определяется через текущие настройки.  

        </p>
<p>
            Первым и важным отличием от Java Lucene является то, что
            по умолчанию элементы ищутся <span class="emphasis"><em>по всем полям</em></span>.

        </p>
<p>
            В классе Zend_Search_Lucene есть два статических метода, которые
            позволяют работать с настройками:  

        </p>
<pre class="programlisting">&lt;?php
$defaultSearchField = Zend_Search_Lucene::getDefaultSearchField();
...
Zend_Search_Lucene::setDefaultSearchField('contents');
?&gt;</pre>
<p>
            Значение <code class="code">null</code> означает, что поиск производится по всем
            полям. Это значение настройки по умолчанию.

        </p>
<p>
            Вы можете указать поле, набирая имя поля с двоеточием ":" в конце
            и затем искомый элемент. 

        </p>
<p>
            Для примера предположим, что индекс Lucene содержит два поля -
            'title' (заголовок) и 'text' (текст), 'text' является полем,
            используемым по умолчанию. Если вы хотите найти документ с
            заголовком "The Right Way", который содержит текст "don't go
            this way", то можете ввести: 

        </p>
<pre class="programlisting">title:"The Right Way" AND text:go</pre>
<p>
            или
        </p>
<pre class="programlisting">title:"Do it right" AND go</pre>
<p>
            Если 'text' является полем, используемым по умолчанию, то указание
            поля не требуется.

        </p>
<p>
            Важно: поле действительно только для того элемента, фразы или
            подзапроса, перед которым он непосредственно стоит. Таким образом,
            запрос 

            </p>
<pre class="programlisting">title:Do it right</pre>
<p>
            будет искать в поле 'title' только "Do". Поиск "it" и "right" будет
            производиться в полях, используемых по умолчанию, если установлены
            поля по умолчанию, или по всем полям, если вместо поля по умолчанию
            установлено <code class="code">null</code>.

        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.modifiers"></a>22.4.3. Модификаторы элементов</h3></div></div></div>
<p>
            Lucene поддерживает модификацию элементов запроса для предоставления
            широкого диапазона опций поиска.

        </p>
<p>
            Zend_Search_Lucene сейчас поддерживает модификатор "~" только для
            фраз  

            <sup>[<a name="id4896123" href="#ftn.id4896123">8</a>]</sup>.
        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.proximity-search"></a>22.4.4. Поиск по критерию близости</h3></div></div></div>
<p>
            Lucene поддерживает поиск слов, находящихся в пределах определенного
            расстояния друг от друга. Для того, чтобы производить поиск по
            критерию близости, используйте тильду "~" в конце фразы. Например,
            для того, чтобы найти в документе "Zend" и "Framework" в пределах
            10 слов, используйте следующий запрос:

            </p>
<pre class="programlisting">"Zend Framework"~10</pre>
<p>
        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.boosting"></a>22.4.5. Усиление элемента</h3></div></div></div>
<p>
            Java Lucene и Zend_Search_Lucene предоставляют уровень релевантности
            соответствующих запросу документов, основыванный на количестве
            найденных элементов. Для того, чтобы усилить элемент, используйте
            знак вставки "^" с коэффициентом усиления после этого элемента. Чем
            больше коэффициент усиления, то тем более релевантным будет элемент.

        </p>
<p>
            Усиление элементов позволяет управлять релевантностью документа.
            Например, если вы ищете

            </p>
<pre class="programlisting">PHP framework</pre>
<p>
            и хотите, чтобы элемент 'PHP' был более релевантным, то усильте
            его, используя символ ^ с коэффициентом усиления после этого
            элемента:

            </p>
<pre class="programlisting">PHP^4 framework</pre>
<p>
            Это сделает более релевантными те документы, в которых встречается
            элемент 'PHP'. Вы можете также усиливать фразы и подзапросы, как в
            примере ниже:
             

            </p>
<pre class="programlisting">"PHP framework"^4 "Zend Framework"</pre>
<p>
            По умолчанию коэффициент усиления равен 1. Несмотря на то, что
            коэффициент усиления должен быть положительным числом, он может быть
            меньше 1 (например, 0.2).  

        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.boolean"></a>22.4.6. Булевы операторы</h3></div></div></div>
<p>
            Булевы операторы позволяют комбинировать элементы через логические
            операторы. Lucene поддерживает AND, "+", OR, NOT и "-" как булевы
            операторы. Java Lucene требует, чтобы все булевы операторы были в
            верхнем регистре, Zend_Search_Lucene этого не требует. 

        </p>
<p>
            Операторы AND, OR, NOT и "+", "-" определяют два различных стиля
            построения запросов. В отличие от Java Lucene, Zend_Search_Lucene не
            позволяет смешивать оба стиля.

        </p>
<p>
            Если используется стиль AND/OR/NOT, то операторы AND/OR должны
            находиться между всеми элементами запроса. Перед любым элементом
            может также находиться оператор NOT. Оператор AND имеет более
            высокий приоритет, чем OR. Этим Zend_Search_Lucene отличается от
            Java Lucene.

        </p>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.and"></a>22.4.6.1. AND</h4></div></div></div>
<p>
                Оператор AND означает, что документ должен соответствовать всем
                элементам в "группе AND". 

            </p>
<p>
                Для поиск документов, содержащих "PHP framework" м "Zend
                Framework" используется запрос:  

                </p>
<pre class="programlisting">"PHP framework" AND "Zend Framework"</pre>
<p>
            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.or"></a>22.4.6.2. OR</h4></div></div></div>
<p>
                Оператор OR делит запрос на несколько необязательных частей.

            </p>
<p>
                Для поиска документов, содержащих "PHP framework" или "Zend
                Framework" используется запрос:  

                </p>
<pre class="programlisting">"PHP framework" OR "Zend Framework"</pre>
<p>
            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.not"></a>22.4.6.3. NOT</h4></div></div></div>
<p>
                Оператор NOT исключает документы, содержащие элемент после NOT.
                Но "группа AND", содержащая только элементы с оператором NOT,
                даст пустой результат вместо всего набора проиндексированных
                документов.   

            </p>
<p>
                Для поиска документов, содержащих "PHP framework", но без "Zend
                Framework", используется запрос: 

                </p>
<pre class="programlisting">"PHP framework" AND NOT "Zend Framework"</pre>
<p>
            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.other-form"></a>22.4.6.4. Операторы &amp;&amp;, ||, и !</h4></div></div></div>
<p>
                Операторы &amp;&amp;, ||, и ! могут использоваться вместо AND,
                OR и NOT. 

            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.plus"></a>22.4.6.5. +</h4></div></div></div>
<p>
                "+" означает, что документ должен соответствовать элементу,
                находящемуся после "+". 

            </p>
<p>
                Для поиска документов, которые должны содержать "Zend" и могут
                содержать "Framework", используется запрос:  

                </p>
<pre class="programlisting">+Zend Framework</pre>
<p>
            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.minus"></a>22.4.6.6. -</h4></div></div></div>
<p>
                "-" исключает документы, соответствующие элементу находящемуся
                после него. 

            </p>
<p>
                Для поиска документов, содержащих "PHP framework",
                но без "Zend Framework", используется запрос:  

                </p>
<pre class="programlisting">"PHP framework" -"Zend Framework"</pre>
<p>
            </p>
</div>
<div class="sect3" lang="ru">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.search.query-language.boolean.no-operator"></a>22.4.6.7. Отсутствие оператора</h4></div></div></div>
<p>
                Если не не указан оператор, то поведение определяется
                используемым по умолчанию булевым оператором.

            </p>
<p>
                По умолчанию таким оператором является <code class="code">OR</code>. 

            </p>
<p>
                Это означает, что данный элемент является необязательным. Он
                может как присутствовать, так и не присутствовать в документе,
                но документы с этим элементом имеют более высокий ранг. 

            </p>
<p>
                Для поиска документов, которые должны содержать "PHP framework"
                и могут содержать "Zend Framework", используется запрос: 

                </p>
<pre class="programlisting">+"PHP framework" "Zend Framework"</pre>
<p>
            </p>
<p>
                Используемые по умолчанию булевы операторы могут быть
                установлены или получены с помощью методов
                <code class="code">Zend_Search_Lucene_Search_QueryParser::setDefaultOperator($operator)</code>
                и <code class="code">Zend_Search_Lucene_Search_QueryParser::getDefaultOperator()</code>.  

            </p>
<p>
                Эти методы работают с константами <code class="code">Zend_Search_Lucene_Search_QueryParser::B_AND</code> и <code class="code">Zend_Search_Lucene_Search_QueryParser::B_OR</code>.

            </p>
</div>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.grouping"></a>22.4.7. Групирование</h3></div></div></div>
<p>
            Java Lucene и Zend_Search_Lucene поддерживают использование
            скобок для группирования условий в подзапросы. Это может быть
            полезным, если вы хотите контролировать булеву логику для запросов
            или смешивать различные стили запросов: 

            </p>
<pre class="programlisting">+(framework OR library) +php</pre>
<p>
            Zend_Search_Lucene поддердивает подзапросы на любой уровни
            вложенности.

        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.field-grouping"></a>22.4.8. Группирование полей</h3></div></div></div>
<p>
            Lucene поддерживает использование скобок для группирования
            нескольких условий применительно к одному полю.

        </p>
<p>
            Для поиска заголовка, содержащего слово "return" и фразу "pink
            panther" используйте запрос: 

            </p>
<pre class="programlisting">title:(+return +"pink panther")</pre>
<p>
            Zend_Search_Lucene поддердивает подзапросы любого уровня
            вложенности.

        </p>
</div>
<div class="sect2" lang="ru">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.search.query-language.escaping"></a>22.4.9. Экранирование специальных символов</h3></div></div></div>
<p>
            Lucene поддерживает экранирование тех специальных символов, которые
            являются частью синтаксиса запросов. Список специальных символов:

        </p>
<p>
            + - &amp;&amp; || ! ( ) { } [ ] ^ " ~ * ? : \
        </p>
<p>
            + и - внутри элемента обрабатываются как обычные символы.

        </p>
<p>
            Для того, чтобы экранировать эти символы, используйте \ перед
            символом. Например, для поиска (1+1):2 используйте запрос: 

            </p>
<pre class="programlisting">\(1\+1\)\:2</pre>
<p>
        </p>
</div>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id4896123" href="#id4896123">8</a>] </sup>
                    "~" по отношению к элементам используется для нечеткого
                    поиска, но запросы для нечеткого поиска еще не
                    поддерживаются.

                </p></div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.search.searching.html">Пред.</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.search.html">Уровень выше</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.search.queries.html">След.</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">22.3. Поиск по индексу </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td>
<td width="40%" align="right" valign="top"> 22.5. Типы запросов </td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
